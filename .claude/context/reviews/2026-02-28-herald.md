# Project Review — Herald (2026-02-28)

## Phase 2 Status: Classification Engine

**Milestone**: v0.2.0 — 14 closed, 2 open issues remaining

Phase 2 is functionally complete. The classification workflow (4-node state graph), classifications domain (types, system, repository, handler), prompts domain, and all API wiring are merged and end-to-end verified against live Azure AI Foundry.

### Completed
- #24: Agent configuration and database schema
- #25: Prompts domain (6 endpoints, two-layer prompt composition)
- #26: Classification workflow (init → classify → enhance? → finalize)
- #47: Classifications domain — types, system, repository
- #48: Classifications handler, API wiring, secrets config, Azure scripts

### Remaining
- #51: Parallelize classify and enhance workflow nodes
- #53: Query builder JOIN support and document classification view (new — identified in this review)

## Review Concerns

### Concern 1: Workflow Progress Tracking

**Resolution**: Defer SSE implementation to Phase 3.

SSE is the correct protocol for classification progress — unidirectional server-push, works behind standard load balancers, auto-reconnects natively. WebSockets rejected due to upgrade negotiation, sticky sessions, and message broker requirements for cluster deployments.

go-agents-orchestration already supports observer injection (`cfg.Observer = "noop"` in `workflow.go:45`). The Phase 3 implementation path is documented: port `StreamingObserver` from agent-lab, define event types, add SSE classify endpoint.

Context captured in `_project/README.md`: Key Decisions table updated, Resolved Questions section updated with SSE vs WebSockets rationale, Phase 3 scope updated to include SSE streaming observer.

### Concern 2: Document Filtering by Classification Metadata

**Resolution**: SQL LEFT JOIN approach. Issue [#53](https://github.com/JaimeStill/herald/issues/53) created.

Extends `pkg/query/ProjectionMap` with JOIN support (context-switching pattern from .NET S2VA), extends `Document` with nullable `Classification`, `Confidence`, and `ClassifiedAt` fields populated via LEFT JOIN on classifications. No dependency graph changes — documents package defines its own nullable fields, no import of classifications.

Key design decisions:
- `Join()` method (not `LeftJoin`) — join type lives on the `joinClause` struct
- `map[string]joinClause` keyed by alias for easy lookup
- Extend `projection` and `scanDocument` directly — no backwards-compat variants needed
- `From()` method on ProjectionMap returns `Table()` + JOIN clauses

## Architecture Assessment

- **LCA pattern**: Working well. Cold start → hot start → graceful shutdown is clean and consistent.
- **Domain patterns**: System/Repository/Handler/Mapping/Errors pattern is mature and reusable.
- **Layered runtime convention**: Classifications encapsulates workflow.Runtime internally — API layer doesn't import workflow. Pattern scales for future domains.
- **Configuration pipeline**: Base JSON + overlay + secrets + env vars with clear precedence. Solid.
- **Query builder**: Needs JOIN support (addressed by #53). Otherwise comprehensive.

## Deliverables

| Artifact | Location |
|----------|----------|
| GitHub issue #53 | Query builder JOIN + document classification view |
| README updates | `_project/README.md` — SSE decision, Phase 3 scope, resolved questions |
| Objective updates | `_project/objective.md` — added #53, corrected sub-issue statuses |
| Project board | #53 added to project #7, Phase 2 |
